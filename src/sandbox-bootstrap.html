<!DOCTYPE html>
<html>
<head>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
  <style>
  body {
    padding-top: 70px;
  }
  .task {
    margin: 5px;
    display: inline-block;
    position: relative;
  }
  .task > .panel-body {
    padding: 5px;
    max-width: 300px;
    height: 3em;
    overflow: hidden;
  }
  .task > .panel-footer {
    padding: 5px;
  }
  .glyphicon-ok {
    float: left;
  }
  svg.overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
  .overlay circle {
    fill: orange;
    opacity: 0.35;
  }
  .editor-button {
    color: white;
    position: absolute;
    pointer-events:none;
  }
  </style>
</head>
<body>

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <form class="navbar-form navbar-left">
      <input type="text" class="form-control" placeholder="Search...">
    </form>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-3 col-md-3 sidebar">
        <div class="panel panel-default">
          <div class="panel-body">
            <p class="input-group">
              <label class="input-group-addon" for="title">Title</label>
              <textarea id="title" class="form-control" rows="2" placeholder="Describe what needs to be done"></textarea>
            </p>

            <p class="input-group">
              <label class="input-group-addon" for="due">Due</label>
              <input id="due" class="form-control" type="date"></input>
            </p>

            <!-- TODO http://timschlechter.github.io/bootstrap-tagsinput/examples/ -->
            <p class="input-group">
              <label class="input-group-addon" for="tags">Tags</label>
              <textarea id="tags" class="form-control" rows="2" placeholder="Add a category"></textarea>
            </p>

            <p class="input-group">
              <label class="input-group-addon" for="deps">Deps</label>
              <textarea id="deps" class="form-control" rows="4" placeholder="Add any dependencies of this task"></textarea>
            </p>
          </div>
        </div>
      </div>

      <div id="tasks" class="col-sm-9 col-md-9 main">

        <div class="task panel panel-primary">
          <div class="panel-body">Clean the room and then have an extremely long title here</div>
          <div class="panel-footer">
            <span class="badge">4h</span>
            <span class="badge">2015.01.01</span>
          </div>
        </div>

        <div class="task panel panel-primary">
          <div class="panel-body">Solve Life's Problems</div>
          <div class="panel-footer">
            <span class="badge">4h</span>
            <span class="badge">2015.01.01</span>
          </div>
        </div>

        <div class="task panel panel-primary">
          <div class="panel-body">Revive the dinosaurs</div>
          <div class="panel-footer">
            <span class="badge">4h</span>
            <span class="badge">2015.01.01</span>
          </div>
        </div>

        <div class="task panel panel-primary">
          <div class="panel-body">Try to create a task that has a ridiculously long title. A title so long that no one ever will want to read it because it's just annoying how you can not put it simply.</div>
          <div class="panel-footer">
            <span class="badge">4h</span>
            <span class="badge">2015.01.01</span>
          </div>
        </div>

        <div class="task panel panel-primary">
          <div class="panel-body">Do something more creative</div>
          <div class="panel-footer">
            <span class="badge">4h</span>
            <span class="badge">2015.01.01</span>
          </div>
        </div>

        <div class="task panel panel-primary">
          <div class="panel-body">Go watch a movie for example</div>
          <div class="panel-footer">
            <span class="badge">4h</span>
            <span class="badge">2015.01.01</span>
          </div>
        </div>

        <div class="task panel panel-primary">
          <div class="panel-body">But seriously, stop procrastinating</div>
          <div class="panel-footer">
            <span class="badge">4h</span>
            <span class="badge">2015.01.01</span>
          </div>
        </div>

        <div class="task panel panel-primary">
          <div class="panel-body">Add some more tasks with very long titles instead, see if you can break Chrome</div>
          <div class="panel-footer">
            <span class="badge">4h</span>
            <span class="badge">2015.01.01</span>
          </div>
        </div>
      </div>
    </div>
  </div>

<script src="https://code.jquery.com/jquery-2.1.3.js"></script>
<script src="https://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.js" charset="utf-8"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script>
"use strict";
var gtdo = gtdo || {};

gtdo.ListItemSelector = function() {
  var editor = undefined;
  var buttonSize = undefined;
  var selectedButtonSize = undefined;

  this.bind = function(listItem) {
    if(editor) editor.remove();

    var item = d3.select(listItem);
    var size = item.node().getBoundingClientRect();
    var w = size.width, h = size.height;
    buttonSize = 60;
    selectedButtonSize = 80;
    var fontSize = buttonSize / 2;

    item.style("width", w+"px").style("height", h+"px");
    editor = item.append("span");

    var svg = editor.append("svg").attr("class", "overlay");
    var top = svg.append("circle").attr("id", "top").attr("cx", w / 2).attr("cy", -buttonSize/2);
    var bottom = svg.append("circle").attr("id", "bottom").attr("cx", w / 2).attr("cy", h + buttonSize/2);
    var left = svg.append("circle").attr("id", "left").attr("cx", -buttonSize/2).attr("cy", h / 2);
    var right = svg.append("circle").attr("id", "right").attr("cx", w + buttonSize/2).attr("cy", h / 2);

    var moveUp = editor.append("i").classed("glyphicon glyphicon-arrow-up editor-button", true)
    .style("right", (w / 2 - fontSize / 2) + "px").style("top", "4px");
    var moveDown = editor.append("i").classed("glyphicon glyphicon-arrow-down editor-button", true)
    .style("right", (w / 2 - fontSize / 2) + "px").style("top", (h - fontSize - 4) + "px");
    var edit = editor.append("i").classed("glyphicon glyphicon-pencil editor-button", true)
    .style("left", "4px").style("top", (h / 2 - fontSize / 2) + "px");
    var complete = editor.append("i").classed("glyphicon glyphicon-ok editor-button", true)
    .style("right", "4px").style("top", (h / 2 - fontSize / 2) + "px");
    editor.selectAll("i").style("font-size", fontSize + "px");

    svg.selectAll("circle").attr("r", 0).attr("r", buttonSize);

    top.on("mouseenter", buttonMouseEnter).on("mouseleave", buttonMouseLeave);
    bottom.on("mouseenter", buttonMouseEnter).on("mouseleave", buttonMouseLeave);
    left.on("mouseenter", buttonMouseEnter).on("mouseleave", buttonMouseLeave);
    right.on("mouseenter", buttonMouseEnter).on("mouseleave", buttonMouseLeave);
  };

  this.unbind = function() {
    if(!editor) return; editor.remove();
  };

  var buttonMouseEnter = function() {
    d3.select(this).transition().duration(200).attr("r", selectedButtonSize).style("opacity", "1.0");
  };

  var buttonMouseLeave = function() {
    d3.select(this).transition().duration(200).attr("r", buttonSize).style("opacity", "");
  };
};

var selector = new gtdo.ListItemSelector();

var hovered = false;
d3.selectAll(".task")
.on("mouseenter", function() {
  selector.bind(this);
})
.on("mouseleave", function() {
  selector.unbind();
});

$(function() {
  $( "#tasks" ).sortable();
  $( "#tasks" ).disableSelection();
});
</script>
</body>
